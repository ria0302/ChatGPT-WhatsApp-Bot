from flask import Flask, request
from twilio.twiml.messaging_response import MessagingResponse
import openai

# Twilio, Flask, ngrok
#personal key
openai.api_key = "<OPEN_API_KEY>"

#using Flask app
app = Flask(__name__)

@app.route("/gpt", methods=['POST'])

def chatgpt():
    
    input = request.form['Body'].lower()
    print(input)

    response = openai.ChatCompletion.create( # 1. Change the function Completion to ChatCompletion
    model = 'gpt-3.5-turbo',
    messages = [ # 2. Change the prompt parameter to the messages parameter
    {'role': 'user', 'content':input}
    ],
  temperature = 1  
)    
    reply = MessagingResponse()
    
    reply.message(response["choices"][0]["message"]["content"])
    print(response["choices"][0]["message"]["content"])

    return str(reply)

if __name__ == "__main__":
    app.run(debug=True)
